<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat Room</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs/lib/stomp.min.js"></script>
    <script>
        var stompClient = null;

        function connect() {
            // SockJS로 서버에 연결 (xhrFields로 withCredentials: false 설정)
            var socket = new SockJS('http://158.247.240.142:80/chat', null, {
                xhrFields: {
                    withCredentials: false
                }
            });
            stompClient = Stomp.over(socket);
            stompClient.connect({}, function (frame) {
                console.log('Connected: ' + frame);
                // 서버로부터 메시지를 수신하는 구독
                stompClient.subscribe('/topic/messages', function (message) {
                    showMessage(JSON.parse(message.body));
                });
            });
        }

        function sendMessage() {
            var inputElement = document.getElementById("messageInput");
            var message = inputElement.value;
            // 메시지 전송
            stompClient.send("/app/send", {}, JSON.stringify({ text: message }));
            inputElement.value = ""; // 입력 필드 초기화
        }

        function showMessage(message) {
            var chatBox = document.getElementById("chatBox");
            var messageElement = document.createElement("div");
            messageElement.textContent = message.text; // 메시지 내용 표시
            chatBox.appendChild(messageElement); // 채팅 상자에 메시지 추가
        }

        document.addEventListener('DOMContentLoaded', function () {
            connect(); // 페이지 로드 시 소켓 연결
        });
    </script>
</head>
<body>
<div>
    <input type="text" id="messageInput" placeholder="Enter your message" />
    <button onclick="sendMessage()">Send</button> <!-- 버튼 클릭 시 메시지 전송 -->
</div>
<div id="chatBox"></div> <!-- 수신된 메시지를 표시할 영역 -->
</body>
</html>
